//
//  LAPluginInstanceCollector_.m
//  ddd
//
//  Created by niu_o0 on 2018/8/21.
//
//

/*
 [{"handlerName":"exec","data":{"plugin":"biz.util","action":"ut","args":{"key":"dd_open_js_monitor","value":"{\"url\":\"https%3A%2F%2Fattend.dingtalk.com%2Fattend%2Findex.html%3FcorpId%3Dding89575633c7cea01c35c2f4657eb6378f%26showmenu%3Dfalse%26dd_share%3Dfalse%26dd_progress%3Dfalse%26dd_web_timestamp%3D1534847074810.488%23%2F\",\"js\":\"2.1.1\",\"cid\":\"\"}"}},"callbackId":"cb_2_1534849539911"},{"handlerName":"exec","data":{"plugin":"internal.log","action":"add","args":{"text":"h5_log=1dd.ready"}},"callbackId":"cb_3_1534849539911"},{"handlerName":"exec","data":{"plugin":"internal.log","action":"add","args":{"text":"h5_log=1{\"isLwpEnable\":true}"}},"callbackId":"cb_4_1534849539911"},{"handlerName":"exec","data":{"plugin":"internal.log","action":"add","args":{"text":"h5_log=1{\"UT\":{\"key\":\"oa_cloud_attendance_cover_version_68\",\"params\":{\"org_id\":\"ding89575633c7cea01c35c2f4657eb6378f\"}}}"}},"callbackId":"cb_5_1534849539912"},{"handlerName":"exec","data":{"plugin":"biz.util","action":"ut","args":{"key":"oa_cloud_attendance_cover_version_68","value":"{\"org_id\":\"ding89575633c7cea01c35c2f4657eb6378f\"}"}},"callbackId":"cb_6_1534849539912"},{"handlerName":"exec","data":{"plugin":"internal.log","action":"add","args":{"text":"h5_log=1{\"cloud_158 1.2.4 (DDSDK_2.1.1)\":\"\"}"}},"callbackId":"cb_7_1534849539912"},{"handlerName":"exec","data":{"plugin":"internal.log","action":"add","args":{"text":"h5_log=1{\"main props\":{\"moduleName\":\"home\",\"match\":{\"path\":\"/\",\"url\":\"/\",\"params\":{},\"isExact\":true},\"location\":{\"pathname\":\"/\",\"search\":\"\",\"hash\":\"\"},\"history\":{\"length\":1,\"action\":\"POP\",\"location\":{\"pathname\":\"/\",\"search\":\"\",\"hash\":\"\"}},\"popupModalSet\":[],\"bottomButtonData\":{},\"attendTrialData\":null,\"newGuideState\":{\"homePage\":0,\"statStep\":0,\"scheduleTable\":0},\"calculatorConfigOpen\":false}}"}},"callbackId":"cb_8_1534849539912"},{"handlerName":"exec","data":{"plugin":"internal.log","action":"add","args":{"text":"h5_log=1{\"get from store\":\"\"}"}},"callbackId":"cb_9_1534849539912"},{"handlerName":"exec","data":{"plugin":"biz.util","action":"timestamp","args":{}},"callbackId":"cb_10_1534849539912"},{"handlerName":"exec","data":{"plugin":"util.localStorage","action":"getItem","args":{"name":"attendance_firstAttendanceFlag"}},"callbackId":"cb_11_1534849539912"},{"handlerName":"exec","data":{"plugin":"biz.user","action":"get","args":{"corpId":"ding89575633c7cea01c35c2f4657eb6378f"}},"callbackId":"cb_12_1534849539912"},{"handlerName":"exec","data":{"plugin":"device.connection","action":"getNetworkType","args":{}},"callbackId":"cb_13_1534849539912"},{"handlerName":"exec","data":{"plugin":"internal.log","action":"add","args":{"text":"h5_log=1{\"UT\":{\"key\":\"oa_cloud_attendance_set_attend_trial_data\",\"params\":{\"org_id\":\"ding89575633c7cea01c35c2f4657eb6378f\"}}}"}},"callbackId":"cb_14_1534849539912"},{"handlerName":"exec","data":{"plugin":"biz.util","action":"ut","args":{"key":"oa_cloud_attendance_set_attend_trial_data","value":"{\"org_id\":\"ding89575633c7cea01c35c2f4657eb6378f\"}"}},"callbackId":"cb_15_1534849539912"},{"handlerName":"exec","data":{"plugin":"internal.request","action":"lwp","args":{"uri":"/r/Adaptor/CalculatorI/getConfig","body":"[\"ding89575633c7cea01c35c2f4657eb6378f\"]"}},"callbackId":"cb_16_1534849539912"},{"handlerName":"exec","data":{"plugin":"internal.log","action":"add","args":{"text":"h5_log=1{\"UA\":\"Mozilla/5.0 (iPhone; CPU iPhone OS 8_3 like Mac OS X) AppleWebKit/600.1.4 (KHTML, like Gecko) Mobile/12F70 AliApp(DingTalk/4.3.9) com.laiwang.DingTalk/10070625 Channel/201200 language/zh-Hans\"}"}},"callbackId":"cb_17_1534849539912"},{"handlerName":"exec","data":{"plugin":"internal.log","action":"add","args":{"text":"h5_log=1{\"appId\":158}"}},"callbackId":"cb_18_1534849539913"},{"handlerName":"exec","data":{"plugin":"internal.log","action":"add","args":{"text":"h5_log=1{\"appVersion attend\":\"20171207\"}"}},"callbackId":"cb_19_1534849539913"},{"handlerName":"exec","data":{"plugin":"internal.log","action":"add","args":{"text":"h5_log=1{\"sdk_version\":\"2.1.1\"}"}},"callbackId":"cb_20_1534849539913"},{"handlerName":"exec","data":{"plugin":"internal.log","action":"add","args":{"text":"h5_log=1{\"module\":{\"i\":337,\"l\":true,\"paths\":[],\"children\":[],\"loaded\":true,\"id\":337,\"webpackPolyfill\":1}}"}},"callbackId":"cb_21_1534849539913"},{"handlerName":"exec","data":{"plugin":"internal.log","action":"add","args":{"text":"h5_log=1{\"UT\":{\"key\":\"oa_attendance_page_enter\",\"params\":{\"location\":\"https://attend.dingtalk.com/attend/index.html?corpId=ding89575633c7cea01c35c2f4657eb6378f&showmenu=false&dd_share=false&dd_progress=false&dd_web_timestamp=1534847074810.488#/\",\"org_id\":\"ding89575633c7cea01c35c2f4657eb6378f\"}}}"}},"callbackId":"cb_22_1534849539913"},{"handlerName":"exec","data":{"plugin":"biz.util","action":"ut","args":{"key":"oa_attendance_page_enter","value":"{\"location\":\"https://attend.dingtalk.com/attend/index.html?corpId=ding89575633c7cea01c35c2f4657eb6378f&showmenu=false&dd_share=false&dd_progress=false&dd_web_timestamp=1534847074810.488#/\",\"org_id\":\"ding89575633c7cea01c35c2f4657eb6378f\"}"}},"callbackId":"cb_23_1534849539913"},{"handlerName":"exec","data":{"plugin":"internal.log","action":"add","args":{"text":"h5_log=1{\"UT\":{\"key\":\"oa_cloud_attendance_common_get_user_access_start\",\"params\":{\"org_id\":\"ding89575633c7cea01c35c2f4657eb6378f\"}}}"}},"callbackId":"cb_24_1534849539913"},{"handlerName":"exec","data":{"plugin":"biz.util","action":"ut","args":{"key":"oa_cloud_attendance_common_get_user_access_start","value":"{\"org_id\":\"ding89575633c7cea01c35c2f4657eb6378f\"}"}},"callbackId":"cb_25_1534849539913"},{"handlerName":"exec","data":{"plugin":"internal.log","action":"add","args":{"text":"h5_log=1{\"lwp\":{\"key\":\"getUserAccess\",\"serviceName\":\"ATCheckI\",\"isArrParams\":true}}"}},"callbackId":"cb_26_1534849539913"},{"handlerName":"exec","data":{"plugin":"internal.log","action":"add","args":{"text":"h5_log=1{\"UT\":{\"key\":\"oa_cloud_attendance_close_offline\",\"params\":{\"api_name\":\"getUserAccess\",\"org_id\":\"ding89575633c7cea01c35c2f4657eb6378f\"}}}"}},"callbackId":"cb_27_1534849539913"},{"handlerName":"exec","data":{"plugin":"biz.util","action":"ut","args":{"key":"oa_cloud_attendance_close_offline","value":"{\"api_name\":\"getUserAccess\",\"org_id\":\"ding89575633c7cea01c35c2f4657eb6378f\"}"}},"callbackId":"cb_28_1534849539913"},{"handlerName":"exec","data":{"plugin":"internal.log","action":"add","args":{"text":"h5_log=1{\"getUserAccess lwp\":[\"ding89575633c7cea01c35c2f4657eb6378f\"]}"}},"callbackId":"cb_29_1534849539913"},{"handlerName":"exec","data":{"plugin":"internal.log","action":"add","args":{"text":"h5_log=1{\"not offline\":\"\"}"}},"callbackId":"cb_30_1534849539913"},{"handlerName":"exec","data":{"plugin":"internal.log","action":"add","args":{"text":"h5_log=1{\"UT\":{\"key\":\"oa_cloud_attendance_not_offline\",\"params\":{\"api_name\":\"getUserAccess\",\"org_id\":\"ding89575633c7cea01c35c2f4657eb6378f\"}}}"}},"callbackId":"cb_31_1534849539913"},{"handlerName":"exec","data":{"plugin":"biz.util","action":"ut","args":{"key":"oa_cloud_attendance_not_offline","value":"{\"api_name\":\"getUserAccess\",\"org_id\":\"ding89575633c7cea01c35c2f4657eb6378f\"}"}},"callbackId":"cb_32_1534849539913"},{"handlerName":"exec","data":{"plugin":"internal.request","action":"lwp","args":{"uri":"/r/Adaptor/ATCheckI/getUserAccess","body":"[\"ding89575633c7cea01c35c2f4657eb6378f\"]"}},"callbackId":"cb_33_1534849539914"},{"handlerName":"exec","data":{"plugin":"biz.util","action":"timestamp","args":{}},"callbackId":"cb_34_1534849539914"},{"handlerName":"exec","data":{"plugin":"util.localStorage","action":"getItem","args":{"name":"attendance_safe_bind_phone_badge_show"}},"callbackId":"cb_35_1534849539914"},{"handlerName":"exec","data":{"plugin":"internal.request","action":"lwp","args":{"uri":"/r/Adaptor/ATCheckI/getTrialCodes","body":"[\"ding89575633c7cea01c35c2f4657eb6378f\"]"}},"callbackId":"cb_36_1534849539914"},{"handlerName":"exec","data":{"plugin":"device.base","action":"getInterface","args":{}},"callbackId":"cb_37_1534849539914"},{"handlerName":"exec","data":{"plugin":"biz.util","action":"timestamp","args":{}},"callbackId":"cb_38_1534849539914"},{"handlerName":"exec","data":{"plugin":"device.geolocation","action":"stop","args":{}},"callbackId":"cb_39_1534849539914"},{"handlerName":"exec","data":{"plugin":"internal.log","action":"add","args":{"text":"h5_log=1{\"module\":{\"i\":337,\"l\":true,\"paths\":[],\"children\":[],\"loaded\":true,\"id\":337,\"webpackPolyfill\":1}}"}},"callbackId":"cb_40_1534849539914"},{"handlerName":"exec","data":{"plugin":"internal.log","action":"add","args":{"text":"h5_log=1{\"UT\":{\"key\":\"oa_cloud_attendance_set_bottom_button_data\",\"params\":{\"org_id\":\"ding89575633c7cea01c35c2f4657eb6378f\"}}}"}},"callbackId":"cb_41_1534849539914"},{"handlerName":"exec","data":{"plugin":"biz.util","action":"ut","args":{"key":"oa_cloud_attendance_set_bottom_button_data","value":"{\"org_id\":\"ding89575633c7cea01c35c2f4657eb6378f\"}"}},"callbackId":"cb_42_1534849539914"},{"handlerName":"exec","data":{"plugin":"internal.log","action":"add","args":{"text":"h5_log=1{\"module\":{\"i\":337,\"l\":true,\"paths\":[],\"children\":[],\"loaded\":true,\"id\":337,\"webpackPolyfill\":1}}"}},"callbackId":"cb_43_1534849539914"},{"handlerName":"exec","data":{"plugin":"device.base","action":"getInterface","args":{}},"callbackId":"cb_44_1534849539914"},{"handlerName":"exec","data":{"plugin":"biz.util","action":"timestamp","args":{}},"callbackId":"cb_45_1534849539914"},{"handlerName":"exec","data":{"plugin":"device.geolocation","action":"stop","args":{}},"callbackId":"cb_46_1534849539915"},{"handlerName":"exec","data":{"plugin":"biz.util","action":"timestamp","args":{}},"callbackId":"cb_47_1534849539916"},{"responseId":"objc_cb_1","responseData":{"errorCode":"0","errorMessage":"成功"}},{"handlerName":"exec","data":{"plugin":"internal.log","action":"add","args":{"text":"h5_log=1{\"networkEvent\":\"\"}"}},"callbackId":"cb_48_1534849539917"},{"handlerName":"exec","data":{"plugin":"device.base","action":"getInterface","args":{}},"callbackId":"cb_49_1534849539917"},{"handlerName":"exec","data":{"plugin":"biz.util","action":"timestamp","args":{}},"callbackId":"cb_50_1534849539917"},{"handlerName":"exec","data":{"plugin":"device.geolocation","action":"stop","args":{}},"callbackId":"cb_51_1534849539917"}]
 */

#import <Foundation/Foundation.h>
#import "CaptainHook/CaptainHook.h"

typedef void(^block)(id dic);

@class LAPluginInstanceCollector;

CHDeclareClass(LAPluginInstanceCollector);

//callback
/*
 0x2C73A0A
 -[LAActionResponse _callbackWithResult:keep:errorCode:errorMessage:]
 0x2C737E0
 -[LAActionResponse success:]
 0x165FDC0
  -[DTLAPNetworkStatus getNetworkType:to:]
 0x2C7A252
 sub_2C7A1D8 ;-[LAPluginInstanceCollector handleJavaScriptRequest:callback:]
 0x2C79B6E
 -[LAPluginInstanceCollector handleJavaScriptRequest:callback:]
 */



/*
 0x2C52C06
 sub_2C52B8C
 0x2C4BEA4
 [LAWebViewJavascriptBridge _handleQueueString:]
 0x2C4B7E8
 -[LAWebViewJavascriptBridge _flushMessageQueue]
 0x2C4C426
 -[LAWebViewJavascriptBridge webView:shouldStartLoadWithRequest:navigationType:]
 0x2C6FFFE
 -[LAWebView callback_webViewShouldStartLoadWithRequest:navigationType:]
 0x2C879EA
  -[LAWebViewProgressEstimater webView:shouldStartLoadWithRequest:navigationType:]
 0x46FD2C0
 -[TOCropViewController setAspectRatioLockEnabled:]
 */
CHMethod2(void, LAPluginInstanceCollector, handleJavaScriptRequest, id, arg1, callback, block, arg2){
    
    //NSLog(@"``````%@", arg1);
    
    if ([arg1[@"action"] isEqualToString:@"getInterface"]){
        
        /*
         errorCode = 0;
         errorMessage = "";
         keep = 0;
         result =     {
         macIp = "2c:c5:d3:1:c1:dc";
         ssid = KuaiYong5G;
         };
         */
        id _callback = ^(id dic){
            NSDictionary *retDic = @{
                                     @"errorCode" : @"0",
                                     @"errorMessage": @"",
                                     @"keep": @"0",
                                     @"result": @{
                                             @"macIp": @"2c:c5:d3:1:c4:9c",
                                             @"ssid": @"KuaiYong5G"
                                             }
                                     };
            arg2(retDic);
        };
        
        CHSuper2(LAPluginInstanceCollector, handleJavaScriptRequest, arg1, callback, _callback);
        
        return;
        
    }else if ([arg1[@"action"] isEqualToString:@"start"]){
        
        /*
         errorCode = 0;
         errorMessage = "";
         keep = 1;
         result =     {
         aMapCode = 0;
         accuracy = 2000;
         latitude = "39.90109239366319";
         longitude = "116.2468956163194";
         netType = wifi;
         operatorType = unknown;
         resultCode = 0;
         resultMessage = "";
         };
         */
        
        id _callback = ^(id dic){
            NSDictionary *retDic = @{
                                     @"errorCode" : @"0",
                                     @"errorMessage": @"",
                                     @"keep": @"1",
                                     @"result": @{
                                             @"aMapCode": @"0",
                                             @"accuracy": @"2000",
                                             @"latitude": @"39.90109239366319",
                                             @"longitude": @"116.2468956163194",
                                             @"netType": @"wifi",
                                             @"operatorType": @"unknown",
                                             @"resultCode": @"0",
                                             @"resultMessage": @""
                                             }
                                     };
            arg2(retDic);
        };
        
        CHSuper2(LAPluginInstanceCollector, handleJavaScriptRequest, arg1, callback, _callback);
        
        return;
        
    }
    
    id _callback = ^(id dic){
        
        NSLog(@"`````````%@````````````%@", arg1, dic);
        
        arg2(dic);
        
    };
    
    CHSuper2(LAPluginInstanceCollector, handleJavaScriptRequest, arg1, callback, _callback);

}



CHConstructor {
    
    CHLoadLateClass(LAPluginInstanceCollector);
    
    CHHook2(LAPluginInstanceCollector, handleJavaScriptRequest, callback);
    
}
